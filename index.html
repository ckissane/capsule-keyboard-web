<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Capsule Keyboard</title>
    <link href="https://fonts.googleapis.com/css?family=Zilla+Slab&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans&display=swap" rel="stylesheet">
    <!-- Main Quill library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <!-- Theme included stylesheets -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.bubble.css" rel="stylesheet">

</head>

<body>
    <div id="world">

        <div id="input-thing"></div>
        <div class="keyboard-con">
            <div class="keyboard">
                <div class="keyboard-main">
                    <div class="key-row">
                        <div class="key key-special" key="">
                            <div class="main-text">ESC</div>
                        </div>
                        <div class="key key-special" key="p">
                            <div class="main-text">F1</div>
                        </div>
                        <div class="key key-special">
                            <div class="main-text">F2</div>
                        </div>
                        <div class="key key-special">
                            <div class="main-text">F3</div>
                        </div>
                        <div class="key key-special">
                            <div class="main-text">F4</div>
                        </div>
                        <div class="key key-special">
                            <div class="main-text">F5</div>
                        </div>
                        <div class="key key-special">
                            <div class="main-text">F6</div>
                        </div>
                        <div class="key key-special">
                            <div class="main-text">F7</div>
                        </div>
                        <div class="key key-special">
                            <div class="main-text">F8</div>
                        </div>
                    </div>
                    <div class="key-row">
                        <div class="key" key="À">
                            <div class="main-text lower-text">`</div>
                            <div class="shift-text">~</div>
                        </div>
                        <div class="key" key="1">
                            <div class="main-text lower-text">1</div>
                            <div class="shift-text">!</div>
                        </div>
                        <div class="key" key="2">
                            <div class="main-text lower-text">2</div>
                            <div class="shift-text">@</div>
                        </div>
                        <div class="key" key="3">
                            <div class="main-text lower-text">3</div>
                            <div class="shift-text">#</div>
                        </div>
                        <div class="key" key="4">
                            <div class="main-text lower-text">4</div>
                            <div class="shift-text">$</div>
                        </div>
                        <div class="key" key="5">
                            <div class="main-text lower-text">5</div>
                            <div class="shift-text">%</div>
                        </div>
                        <div class="key" key="6">
                            <div class="main-text lower-text">6</div>
                            <div class="shift-text">^</div>
                        </div>
                        <div class="key" key="7">
                            <div class="main-text lower-text">7</div>
                            <div class="shift-text">&</div>
                        </div>
                        <div class="key" key="8">
                            <div class="main-text lower-text">8</div>
                            <div class="shift-text">*</div>
                        </div>
                        <div class="key" key="9">
                            <div class="main-text lower-text">9</div>
                            <div class="shift-text">(</div>
                        </div>
                        <div class="key" key="0">
                            <div class="main-text lower-text">0</div>
                            <div class="shift-text">)</div>
                        </div>
                        <div class="key" key="½">
                            <div class="main-text lower-text">-</div>
                            <div class="shift-text">_</div>
                        </div>
                        <div class="key" key="»">
                            <div class="main-text lower-text">=</div>
                            <div class="shift-text">+</div>
                        </div>

                        <div class="key key-special" key="" style="width:128px;">
                            <div class="main-text">BACKSPACE</div>
                        </div>
                    </div>
                    <div class="key-row">
                        <div class="key key-special" key="	" style="width:128px;">
                            <div class="main-text">TAB</div>
                        </div>
                        <div class="key" key="Q">
                            <div class="main-text lower-text">q</div>
                            <div class="shift-text">Q</div>
                            <div class="command-text"><img src="actions/exit.svg" /></div>
                        </div>
                        <div class="key" key="W">
                            <div class="main-text lower-text">w</div>
                            <div class="shift-text">W</div>
                        </div>
                        <div class="key" key="E">
                            <div class="main-text lower-text">e</div>
                            <div class="shift-text">E</div>
                        </div>
                        <div class="key" key="R">
                            <div class="main-text lower-text">r</div>
                            <div class="shift-text">R</div>
                            <div class="command-text"><img src="actions/edit-redo.svg" /></div>
                        </div>
                        <div class="key" key="T">
                            <div class="main-text lower-text">t</div>
                            <div class="shift-text">T</div>
                        </div>
                        <div class="key" key="Y">
                            <div class="main-text lower-text">y</div>
                            <div class="shift-text">Y</div>
                        </div>
                        <div class="key" key="U">
                            <div class="main-text lower-text">u</div>
                            <div class="shift-text">U</div>
                        </div>
                        <div class="key" key="I">
                            <div class="main-text lower-text">i</div>
                            <div class="shift-text">I</div>
                        </div>
                        <div class="key" key="O">
                            <div class="main-text lower-text">o</div>
                            <div class="shift-text">O</div>
                        </div>
                        <div class="key" key="P">
                            <div class="main-text lower-text">p</div>
                            <div class="shift-text">P</div>
                        </div>
                        <div class="key" key="Û">
                            <div class="main-text lower-text">[</div>
                            <div class="shift-text">{</div>
                        </div>
                        <div class="key" key="Ý">
                            <div class="main-text lower-text">]</div>
                            <div class="shift-text">}</div>
                        </div>
                        <div class="key" key="Ü">
                            <div class="main-text lower-text">\</div>
                            <div class="shift-text">|</div>
                        </div>

                    </div>
                    <div class="key-row">
                        <div class="key key-special" key="caps-lock" style="width:160px;">
                            <div class="main-text">CAPS LOCK</div>
                        </div>
                        <div class="key" key="A">
                            <div class="main-text lower-text">a</div>
                            <div class="shift-text">A</div>
                            <div class="command-text"><img src="actions/edit-select-all.svg" /></div>
                        </div>
                        <div class="key" key="S">
                            <div class="main-text lower-text">s</div>
                            <div class="shift-text">S</div>
                            <div class="command-text"><img src="actions/document-save.svg" /></div>
                        </div>
                        <div class="key" key="D">
                            <div class="main-text lower-text">d</div>
                            <div class="shift-text">D</div>
                        </div>
                        <div class="key" key="F">
                            <div class="main-text lower-text">f</div>
                            <div class="shift-text">F</div>
                            <div class="command-text"><img src="actions/search.svg" /></div>
                        </div>
                        <div class="key" key="G">
                            <div class="main-text lower-text">g</div>
                            <div class="shift-text">G</div>
                        </div>
                        <div class="key" key="H">
                            <div class="main-text lower-text">h</div>
                            <div class="shift-text">H</div>
                        </div>
                        <div class="key" key="J">
                            <div class="main-text lower-text">j</div>
                            <div class="shift-text">J</div>
                        </div>
                        <div class="key" key="K">
                            <div class="main-text lower-text">k</div>
                            <div class="shift-text">K</div>
                        </div>
                        <div class="key" key="L">
                            <div class="main-text lower-text">l</div>
                            <div class="shift-text">L</div>
                        </div>
                        <div class="key" key="º">
                            <div class="main-text lower-text">;</div>
                            <div class="shift-text">:</div>
                        </div>
                        <div class="key" key="Þ">
                            <div class="main-text lower-text">'</div>
                            <div class="shift-text">"</div>
                        </div>
                        <div class="key key-special" key="enter" style="width:144px;">
                            <div class="main-text">ENTER</div>
                        </div>
                    </div>
                    <div class="key-row">
                        <div class="key key-special" key="" style="width:200px;">
                            <div class="main-text">SHIFT</div>
                        </div>
                        <div class="key" key="Z">
                            <div class="main-text lower-text">z</div>
                            <div class="shift-text">Z</div>
                            <div class="command-text"><img src="actions/edit-undo.svg" /></div>
                        </div>
                        <div class="key" key="X">
                            <div class="main-text lower-text">x</div>
                            <div class="shift-text">X</div>
                            <div class="command-text"><img src="actions/edit-cut.svg" /></div>
                        </div>
                        <div class="key" key="C">
                            <div class="main-text lower-text">c</div>
                            <div class="shift-text">C</div>
                            <div class="command-text"><img src="actions/edit-copy.svg" /></div>
                        </div>
                        <div class="key" key="V">
                            <div class="main-text lower-text">v</div>
                            <div class="shift-text">V</div>
                            <div class="command-text"><img src="actions/edit-paste.svg" /></div>
                            <!-- <div class="command-alt-text"><img src="actions/edit-paste-in-place.svg"/></div> -->
                        </div>
                        <div class="key" key="B">
                            <div class="main-text lower-text">b</div>
                            <div class="shift-text">B</div>
                            <!-- <div class="command-alt-text"><img src="actions/edit-paste-in-place.svg"/></div> -->
                        </div>
                        <div class="key" key="N">
                            <div class="main-text lower-text">n</div>
                            <div class="shift-text">N</div>
                            <!-- <div class="command-alt-text"><img src="actions/edit-paste-in-place.svg"/></div> -->
                        </div>
                        <div class="key" key="M">
                            <div class="main-text lower-text">m</div>
                            <div class="shift-text">M</div>
                            <!-- <div class="command-alt-text"><img src="actions/edit-paste-in-place.svg"/></div> -->
                        </div>
                        <div class="key" key="¼">
                            <div class="main-text lower-text">,</div>
                            <div class="shift-text">&lt;</div>
                            <!-- <div class="command-alt-text"><img src="actions/edit-paste-in-place.svg"/></div> -->
                        </div>
                        <div class="key" key="¾">
                            <div class="main-text lower-text">.</div>
                            <div class="shift-text">&gt;</div>
                            <!-- <div class="command-alt-text"><img src="actions/edit-paste-in-place.svg"/></div> -->
                        </div>
                        <div class="key" key="¿">
                            <div class="main-text lower-text">/</div>
                            <div class="shift-text">?</div>
                            <!-- <div class="command-alt-text"><img src="actions/edit-paste-in-place.svg"/></div> -->
                        </div>
                        <div class="key key-special" key="" style="width:200px;">
                            <div class="main-text">SHIFT</div>
                        </div>
                    </div>
                    <div class="key-row">
                        <div class="key key-special" key="" style="width:128px;">
                            <div class="main-text">CONTROL</div>
                        </div>
                        <div class="key key-special" key="" style="width:128px;">
                            <div class="main-text">ALT</div>
                        </div>
                        <div class="key key-special" key="[" style="width:128px;">
                            <div class="main-text"><img src="actions/draw-cuboid.svg" /></div>
                        </div>
                        <div class="key" key=" " style="width:512px;">

                        </div>
                        <div class="key key-special" key="[" style="width:128px;">
                            <div class="main-text"><img src="actions/draw-cuboid.svg" /></div>
                        </div>
                        <div class="key key-special" key="" style="width:128px;">
                            <div class="main-text">FN</div>
                        </div>
                        <div class="key key-special" key="" style="width:128px;">
                            <div class="main-text">CONTROL</div>
                        </div>
                    </div>
                </div>
                <div class="keyboard-right">

                </div>
            </div>
        </div>

    </div>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            user-select: none;
            overflow: hidden;
        }
        
        #world {
            background: url(wall_bottom.jpg);
            background-size: cover;
            width: 100vw;
            height: 100vh;
            /* overflow: auto; */
            color: white;
            padding: 0px;
            font-size: 18px;
            line-height: 24px;
            font-family: 'IBM Plex Sans', sans-serif;
            text-align: left;
            display: flex;
            flex-direction: column;
        }
        
        #input-thing {
            width: 100vw;
            flex: 1 0;
        }
        
        .key-row {
            width: calc(1376px + 16px);
            font-size: 0px;
            text-align: left;
        }
        
        .keyboard-main {
            width: calc(1376px + 16px);
        }
        
        .keyboard {
            display: inline-block;
            width: calc(1376px + 16px);
        }
        
        .window {
            /* backdrop-filter: blur(10px) brightness(50%); */
            background: rgba(0, 0, 0, 0.5);
            padding: 2px;
            margin: 2px;
        }
        
        .key {
            text-align: center;
            backdrop-filter: blur(15px);
            background: rgba(0, 0, 0, 0.25);
            /* padding: 8px; */
            margin: 8px;
            box-sizing: border-box;
            height: 80px;
            /* padding-left: 10px;
            padding-right: 10px; */
            display: inline-block;
            transition: box-shadow 0.25s;
            vertical-align: top;
            width: 80px;
            border-radius: 12px;
            position: relative;
            font-size: 24px;
            line-height: 32px;
        }
        
        .key.pressed {
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.25);
        }
        
        .key.key-special {
            font-size: 18px;
            line-height: 24px;
        }
        
        .key .main-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.2s;
        }
        
        .key .shift-text {
            position: absolute;
            top: 25%;
            left: 25%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            line-height: 24px;
            transition: all 0.2s;
        }
        
        .key .command-text {
            position: absolute;
            top: 75%;
            left: 25%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            line-height: 24px;
            transition: all 0.2s;
        }
        
        .keyboard.shift-held .key .shift-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            line-height: 32px;
            transition: all 0.2s;
        }
        
        .keyboard.shift-held .key .lower-text {
            position: absolute;
            top: 75%;
            left: 75%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            line-height: 24px;
            transition: all 0.2s;
        }
        
        .keyboard.command-held .key .command-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            line-height: 32px;
            transition: all 0.2s;
        }
        
        .keyboard.command-held .key .shift-text {
            position: absolute;
            top: 25%;
            left: 25%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            line-height: 24px;
            transition: all 0.2s;
        }
        
        .keyboard.command-held .key .lower-text {
            position: absolute;
            top: 75%;
            left: 75%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            line-height: 24px;
            transition: all 0.2s;
        }
        
        .key * {
            pointer-events: none;
        }
    </style>

    <script>
        var keyboardMap = [
            "", // [0]
            "", // [1]
            "", // [2]
            "CANCEL", // [3]
            "", // [4]
            "", // [5]
            "HELP", // [6]
            "", // [7]
            "BACK_SPACE", // [8]
            "TAB", // [9]
            "", // [10]
            "", // [11]
            "CLEAR", // [12]
            "ENTER", // [13]
            "ENTER_SPECIAL", // [14]
            "", // [15]
            "SHIFT", // [16]
            "CONTROL", // [17]
            "ALT", // [18]
            "PAUSE", // [19]
            "CAPS_LOCK", // [20]
            "KANA", // [21]
            "EISU", // [22]
            "JUNJA", // [23]
            "FINAL", // [24]
            "HANJA", // [25]
            "", // [26]
            "ESCAPE", // [27]
            "CONVERT", // [28]
            "NONCONVERT", // [29]
            "ACCEPT", // [30]
            "MODECHANGE", // [31]
            "SPACE", // [32]
            "PAGE_UP", // [33]
            "PAGE_DOWN", // [34]
            "END", // [35]
            "HOME", // [36]
            "LEFT", // [37]
            "UP", // [38]
            "RIGHT", // [39]
            "DOWN", // [40]
            "SELECT", // [41]
            "PRINT", // [42]
            "EXECUTE", // [43]
            "PRINTSCREEN", // [44]
            "INSERT", // [45]
            "DELETE", // [46]
            "", // [47]
            "0", // [48]
            "1", // [49]
            "2", // [50]
            "3", // [51]
            "4", // [52]
            "5", // [53]
            "6", // [54]
            "7", // [55]
            "8", // [56]
            "9", // [57]
            "COLON", // [58]
            "SEMICOLON", // [59]
            "LESS_THAN", // [60]
            "EQUALS", // [61]
            "GREATER_THAN", // [62]
            "QUESTION_MARK", // [63]
            "AT", // [64]
            "A", // [65]
            "B", // [66]
            "C", // [67]
            "D", // [68]
            "E", // [69]
            "F", // [70]
            "G", // [71]
            "H", // [72]
            "I", // [73]
            "J", // [74]
            "K", // [75]
            "L", // [76]
            "M", // [77]
            "N", // [78]
            "O", // [79]
            "P", // [80]
            "Q", // [81]
            "R", // [82]
            "S", // [83]
            "T", // [84]
            "U", // [85]
            "V", // [86]
            "W", // [87]
            "X", // [88]
            "Y", // [89]
            "Z", // [90]
            "OS_KEY", // [91] Windows Key (Windows) or Command Key (Mac)
            "", // [92]
            "CONTEXT_MENU", // [93]
            "", // [94]
            "SLEEP", // [95]
            "NUMPAD0", // [96]
            "NUMPAD1", // [97]
            "NUMPAD2", // [98]
            "NUMPAD3", // [99]
            "NUMPAD4", // [100]
            "NUMPAD5", // [101]
            "NUMPAD6", // [102]
            "NUMPAD7", // [103]
            "NUMPAD8", // [104]
            "NUMPAD9", // [105]
            "MULTIPLY", // [106]
            "ADD", // [107]
            "SEPARATOR", // [108]
            "SUBTRACT", // [109]
            "DECIMAL", // [110]
            "DIVIDE", // [111]
            "F1", // [112]
            "F2", // [113]
            "F3", // [114]
            "F4", // [115]
            "F5", // [116]
            "F6", // [117]
            "F7", // [118]
            "F8", // [119]
            "F9", // [120]
            "F10", // [121]
            "F11", // [122]
            "F12", // [123]
            "F13", // [124]
            "F14", // [125]
            "F15", // [126]
            "F16", // [127]
            "F17", // [128]
            "F18", // [129]
            "F19", // [130]
            "F20", // [131]
            "F21", // [132]
            "F22", // [133]
            "F23", // [134]
            "F24", // [135]
            "", // [136]
            "", // [137]
            "", // [138]
            "", // [139]
            "", // [140]
            "", // [141]
            "", // [142]
            "", // [143]
            "NUM_LOCK", // [144]
            "SCROLL_LOCK", // [145]
            "WIN_OEM_FJ_JISHO", // [146]
            "WIN_OEM_FJ_MASSHOU", // [147]
            "WIN_OEM_FJ_TOUROKU", // [148]
            "WIN_OEM_FJ_LOYA", // [149]
            "WIN_OEM_FJ_ROYA", // [150]
            "", // [151]
            "", // [152]
            "", // [153]
            "", // [154]
            "", // [155]
            "", // [156]
            "", // [157]
            "", // [158]
            "", // [159]
            "CIRCUMFLEX", // [160]
            "EXCLAMATION", // [161]
            "DOUBLE_QUOTE", // [162]
            "HASH", // [163]
            "DOLLAR", // [164]
            "PERCENT", // [165]
            "AMPERSAND", // [166]
            "UNDERSCORE", // [167]
            "OPEN_PAREN", // [168]
            "CLOSE_PAREN", // [169]
            "ASTERISK", // [170]
            "PLUS", // [171]
            "PIPE", // [172]
            "HYPHEN_MINUS", // [173]
            "OPEN_CURLY_BRACKET", // [174]
            "CLOSE_CURLY_BRACKET", // [175]
            "TILDE", // [176]
            "", // [177]
            "", // [178]
            "", // [179]
            "", // [180]
            "VOLUME_MUTE", // [181]
            "VOLUME_DOWN", // [182]
            "VOLUME_UP", // [183]
            "", // [184]
            "", // [185]
            "SEMICOLON", // [186]
            "EQUALS", // [187]
            "COMMA", // [188]
            "MINUS", // [189]
            "PERIOD", // [190]
            "SLASH", // [191]
            "BACK_QUOTE", // [192]
            "", // [193]
            "", // [194]
            "", // [195]
            "", // [196]
            "", // [197]
            "", // [198]
            "", // [199]
            "", // [200]
            "", // [201]
            "", // [202]
            "", // [203]
            "", // [204]
            "", // [205]
            "", // [206]
            "", // [207]
            "", // [208]
            "", // [209]
            "", // [210]
            "", // [211]
            "", // [212]
            "", // [213]
            "", // [214]
            "", // [215]
            "", // [216]
            "", // [217]
            "", // [218]
            "OPEN_BRACKET", // [219]
            "BACK_SLASH", // [220]
            "CLOSE_BRACKET", // [221]
            "QUOTE", // [222]
            "", // [223]
            "META", // [224]
            "ALTGR", // [225]
            "", // [226]
            "WIN_ICO_HELP", // [227]
            "WIN_ICO_00", // [228]
            "", // [229]
            "WIN_ICO_CLEAR", // [230]
            "", // [231]
            "", // [232]
            "WIN_OEM_RESET", // [233]
            "WIN_OEM_JUMP", // [234]
            "WIN_OEM_PA1", // [235]
            "WIN_OEM_PA2", // [236]
            "WIN_OEM_PA3", // [237]
            "WIN_OEM_WSCTRL", // [238]
            "WIN_OEM_CUSEL", // [239]
            "WIN_OEM_ATTN", // [240]
            "WIN_OEM_FINISH", // [241]
            "WIN_OEM_COPY", // [242]
            "WIN_OEM_AUTO", // [243]
            "WIN_OEM_ENLW", // [244]
            "WIN_OEM_BACKTAB", // [245]
            "ATTN", // [246]
            "CRSEL", // [247]
            "EXSEL", // [248]
            "EREOF", // [249]
            "PLAY", // [250]
            "ZOOM", // [251]
            "", // [252]
            "PA1", // [253]
            "WIN_OEM_CLEAR", // [254]
            "" // [255]
        ];
        var keyboardEl = document.querySelector(".keyboard");
        var shiftHeld = false;
        var commandHeld = false;
        var metaHeld = false;
        var capsLock = false;
       var selection={index:0,length:0};
        function updateKeyboard() {
            if (shiftHeld || capsLock) {
                keyboardEl.classList.add("shift-held");
            } else {
                keyboardEl.classList.remove("shift-held");

            }
            if (capsLock) {
                var el = document.querySelector(`.key[key="caps-lock"]`);
                if (el) el.classList.add("pressed");
            } else {
                var el = document.querySelector(`.key[key="caps-lock"]`);
                if (el) el.classList.remove("pressed");
            }
            if (commandHeld || metaHeld) {
                keyboardEl.classList.add("command-held");
            } else {
                keyboardEl.classList.remove("command-held");
            }
        }

       
document.onkeypress = function (e)
{
    e = e || window.event;
    if (e.charCode === 0 || e.ctrlKey || document.onkeypress.punctuation.indexOf(e.charCode) >= 0)
        return;
    var s = String.fromCharCode(e.charCode); // or e.keyCode for compatibility, but then have to handle MORE non-character keys
    var s2 = e.shiftKey ? s.toUpperCase() : s.toLowerCase();
    var capsLockOn = (s2 !== s);
    if(s.toUpperCase() !== s.toLowerCase()){
    capsLock=capsLockOn;
    }
}
document.onkeypress.punctuation = [33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,91,92,93,94,95,96,123,124,125,126];
        function keyDown(keyEvent, special) {
            console.log(keyEvent)
            // shiftHeld = keyEvent.shiftKey;
            // commandHeld = keyEvent.ctrlKey;

            // if(keyEvent.)
            // document.getElementById("input-thing").dispatchEvent(new KeyboardEvent("keydown", keyEvent));
            var k = String.fromCharCode(keyEvent.which);
            metaHeld = (k === "[") || metaHeld;
            commandHeld = (k === "") || commandHeld;
            shiftHeld = (k === "") || shiftHeld;
            if (keyEvent.which === 20) {
                capsLock = !capsLock;
            }
            // if(keyEvent.getModifierState){
            //     capsLock=keyEvent.getModifierState("CapsLock");
            // }

            console.log(k, keyEvent.which);
            document.querySelectorAll(`.key[key="${k.replace(String.fromCharCode(13),"enter")}"]`).forEach((
                el) => el.classList.add("pressed"));

            if (special) {
                var txt = s;
                var ee = {
                    which: keyEvent.which,
                    shiftKey: shiftHeld,
                    metaKey: metaHeld,
                    ctrlKey: commandHeld,
                    key: shiftHeld ? keyboardMap[keyEvent.which] : keyboardMap[keyEvent.which].toLowerCase()
                };
                if (ee.key == "close_bracket") {
                    ee.key = "]";
                }
                if (ee.key == "open_bracket") {
                    ee.key = "[";
                }
                if (ee.key.toLowerCase() == "close_bracket") {
                    ee.key = "}";
                }
                if (ee.key.toLowerCase() == "open_bracket") {
                    ee.key = "{";
                }
                if (ee.key.toLowerCase() == "enter") {
                    ee.key = "\n";
                }
                if (ee.key == "equals") {
                    ee.key = "=";
                }
                if (ee.key.toLowerCase() == "equals") {
                    ee.key = "+";
                }
                if (ee.key == "back_quote") {
                    ee.key = "`";
                }
                if (ee.key.toLowerCase() == "back_quote") {
                    ee.key = "~";
                }
                if (ee.key == "minus") {
                    ee.key = "-";
                }
                if (ee.key.toLowerCase() == "minus") {
                    ee.key = "_";
                }
                if (ee.key == "back_slash") {
                    ee.key = "\\";
                }
                if (ee.key.toLowerCase() == "back_slash") {
                    ee.key = "|";
                }

                if (ee.key == "semicolon") {
                    ee.key = ";";
                }
                if (ee.key.toLowerCase() == "semicolon") {
                    ee.key = ":";
                }

                if (ee.key == "quote") {
                    ee.key = "'";
                }
                if (ee.key.toLowerCase() == "quote") {
                    ee.key = "\"";
                }
                if (ee.key == "slash") {
                    ee.key = "/";
                }
                if (ee.key.toLowerCase() == "slash") {
                    ee.key = "?";
                }

                if (ee.key == "period") {
                    ee.key = ".";
                }
                if (ee.key.toLowerCase() == "period") {
                    ee.key = ">";
                }
                if (ee.key == "comma") {
                    ee.key = ",";
                }
                if (ee.key.toLowerCase() == "comma") {
                    ee.key = "<";
                }
                if (ee.key === "1" && ee.shiftKey) {
                    ee.key = "!";
                }
                if (ee.key === "2" && ee.shiftKey) {
                    ee.key = "@";
                }
                if (ee.key === "3" && ee.shiftKey) {
                    ee.key = "#";
                }
                if (ee.key === "4" && ee.shiftKey) {
                    ee.key = "$";
                }
                if (ee.key === "5" && ee.shiftKey) {
                    ee.key = "%";
                }
                if (ee.key === "6" && ee.shiftKey) {
                    ee.key = "^";
                }
                if (ee.key === "7" && ee.shiftKey) {
                    ee.key = "&";
                }
                if (ee.key === "8" && ee.shiftKey) {
                    ee.key = "*";
                }
                if (ee.key === "9" && ee.shiftKey) {
                    ee.key = "(";
                }
                if (ee.key === "0" && ee.shiftKey) {
                    ee.key = ")";
                }
                console.log(ee);
                var s = {index:selection.index+0,length:selection.length+0};//editor.getSelection();
                if (!s) {
                    s = {
                        index: 0,
                        length: 0
                    }
                }
                if (ee.key.length === 1) {
                    editor.insertText(s, ee.key, "api");
                    selection=({
                        index: s.index + 1,
                        length: 0
                    });
                } else if (ee.key.toLowerCase() == "back_space") {
                    if (s.length == 0 && s.index>0) {
                        s = {
                            index: s.index - 1,
                            length: 1
                        }
                    }
                    editor.deleteText(s, "api");
selection={index:Math.max(s.index,0),length:0};
                    // editor.setSelection({
                    //     index: s.index + 1,
                    //     length: 0
                    // });
                }
            }
            updateKeyboard();
        }
        window.addEventListener("keydown", keyDown)
        document.querySelectorAll(".key").forEach(el => {
            el.addEventListener("touchstart", (e) => {
                var vou = e.target.getAttribute("key");
                if (vou) {
                    if (vou === "enter") {
                        vou = 13;

                    }else if (vou === "caps-lock") {
                        vou = 20;

                    } else {
                        vou = vou.charCodeAt(0);
                    }
                    keyDown({
                        which: vou
                    }, true)
                }
            });
            // el.addEventListener("mousedown", (e) => {
            //     var vou = e.target.getAttribute("key");
            //     if (vou) {
            //         if (vou === "enter") {
            //             vou = 13;

            //         } else {
            //             vou = vou.charCodeAt(0);
            //         }
            //         keyDown({
            //             which: vou
            //         }, true)
            //     }
            // });


            el.addEventListener("touchend", (e) => {
                var vou = e.target.getAttribute("key");
                if (vou) {
                    if (vou === "enter") {
                        vou = 13;

                    } else {
                        vou = vou.charCodeAt(0);
                    }
                    keyUp({
                        which: vou
                    })
                }
            });
            // el.addEventListener("mouseup", (e) => {
            //     var vou = e.target.getAttribute("key");
            //     if (vou) {
            //         if (vou === "enter") {
            //             vou = 13;

            //         } else {
            //             vou = vou.charCodeAt(0);
            //         }
            //         keyUp({
            //             which: vou
            //         })
            //     }
            // });
        });

        function keyUp(keyEvent) {
            // shiftHeld = keyEvent.shiftKey;
            // commandHeld = keyEvent.ctrlKey && (!(k === "["));
            var k = String.fromCharCode(keyEvent.which);
            metaHeld = !(k === "[") && metaHeld;
            commandHeld = !(k === "") && commandHeld;
            shiftHeld = !(k === "") && shiftHeld;

            console.log(k, keyEvent.which);
            
            // if (keyEvent.which === 20) {
            //     capsLock = !capsLock;
            // }
            // if(keyEvent.getModifierState){
            //     capsLock=keyEvent.getModifierState("CapsLock");
            // }

            document.querySelectorAll(`.key[key="${k.replace(String.fromCharCode(13),"enter")}"]`).forEach((
                el) => el.classList.remove("pressed"));
            updateKeyboard();
        }
        window.addEventListener("keyup", keyUp)
            // window.addEventListener("keypress", function(keyEvent) {
            //     shiftHeld=keyEvent.shiftKey;
            //     commandHeld=keyEvent.ctrlKey;
            //     metaHeld=keyEvent.metaKey;
            //     var k=String.fromCharCode(keyEvent.which);
            //     console.log(k,keyEvent.which);
            //     if(keyEvent.which===20){
            //         capsLock=!capsLock;
            //     }
            //     var el=document.querySelector(`.key[key="${k}"]`);
            //     if(el)el.classList.remove("pressed");
            //     updateKeyboard();
            // })
        window.setInterval(function() {
            keyboardEl.style.transform = `scale(${window.innerWidth/(1376+ 16)})`;
            keyboardEl.style.transformOrigin = `top left`;
            document.querySelector(".keyboard-con").style.height = (window.innerWidth / (1376 + 16) * 96 * 6) + "px";
var c=editor.getSelection();
if(c){
selection=c;
}
editor.blur();
        }, 1000 / 60)
        var container = document.getElementById('input-thing');
        var editor = new Quill(container, {
            modules: {
                // toolbar: {
                //     container: '#toolbar', // Selector for toolbar container
                // }
            }
        });
    </script>
</body>

</html>
